# CAMARA Repository State Schema
# Schema for repository-state.yaml containing auto-generated GitHub state snapshot
# Version: 1.0.0

$schema: http://json-schema.org/draft-07/schema#
title: CAMARA Repository State
description: Auto-generated snapshot of repository state from GitHub API
type: object
required:
  - metadata
  - repositories

properties:
  metadata:
    type: object
    required:
      - generated_at
      - workflow_run
    properties:
      generated_at:
        type: string
        format: date-time
        description: ISO 8601 timestamp when state was generated
      workflow_run:
        type: string
        description: GitHub workflow run ID that generated this state
      repository_count:
        type: integer
        minimum: 0
        description: Total number of repositories in this snapshot

  repositories:
    type: array
    description: List of repository states
    items:
      type: object
      required:
        - name
        - state
      properties:
        name:
          type: string
          description: Repository name from repository-registry.yaml
          pattern: ^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$

        state:
          type: object
          description: Current GitHub state for this repository
          properties:
            topics:
              type: array
              description: Repository topics
              items:
                type: string

            description:
              type: ["string", "null"]
              description: Repository description

            license:
              type: ["string", "null"]
              description: SPDX license identifier

            visibility:
              type: string
              enum:
                - public
                - private
              description: Repository visibility

            last_activity:
              type: ["string", "null"]
              format: date
              description: Date of last activity (YYYY-MM-DD)

            last_commit:
              type: ["string", "null"]
              format: date
              description: Date of last commit to default branch (YYYY-MM-DD)

            open_issues_count:
              type: integer
              minimum: 0
              description: Number of open issues

            open_prs_count:
              type: integer
              minimum: 0
              description: Number of open pull requests

            maintainers_count:
              type: ["integer", "null"]
              minimum: 0
              description: Number of maintainers parsed from MAINTAINERS.md

            archived:
              type: boolean
              description: Whether repository is archived

            default_branch:
              type: string
              description: Default branch name

            has_wiki:
              type: boolean
              description: Whether wiki is enabled

            has_issues:
              type: boolean
              description: Whether issues are enabled

            has_discussions:
              type: boolean
              description: Whether discussions are enabled

            branch_protection:
              type: ["object", "null"]
              description: Branch protection rules for default branch
              properties:
                enabled:
                  type: boolean
                  description: Whether any branch protection is enabled
                require_pull_request_reviews:
                  type: boolean
                  description: Whether PR reviews are required
                require_status_checks:
                  type: boolean
                  description: Whether status checks are required
                enforce_admins:
                  type: boolean
                  description: Whether rules apply to administrators

            files_present:
              type: object
              description: Presence check for key files
              properties:
                readme:
                  type: boolean
                  description: README.md exists at root
                license:
                  type: boolean
                  description: LICENSE file exists
                codeowners:
                  type: boolean
                  description: CODEOWNERS file exists (.github/ or root)
                maintainers:
                  type: boolean
                  description: MAINTAINERS.md file exists
                governance:
                  type: boolean
                  description: GOVERNANCE.md file exists
                changelog:
                  type: boolean
                  description: CHANGELOG.md file exists

            directories_present:
              type: object
              description: Presence check for required directories (API repos)
              properties:
                api_definitions:
                  type: boolean
                  description: code/API_definitions directory exists
                test_definitions:
                  type: boolean
                  description: code/Test_definitions directory exists
                documentation:
                  type: boolean
                  description: documentation directory exists
                issue_templates:
                  type: boolean
                  description: .github/ISSUE_TEMPLATE directory exists
                workflows:
                  type: boolean
                  description: .github/workflows directory exists
